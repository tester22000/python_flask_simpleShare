{% extends "base.html" %}

{% block title %}내용 등록{% endblock %}

{% block content %}
<div class="container mx-auto p-4 flex-grow">
    <div class="bg-white rounded-lg shadow-md p-6">
        <form id="text-form">
            <div class="mb-4">
                <label for="contents" class="block text-gray-700 font-semibold mb-2">내용</label>
                <textarea id="contents" name="contents" rows="10" placeholder="공유할 텍스트를 입력하세요. Markdown 문법을 지원합니다." 
                          class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                <p class="text-sm text-gray-500 mt-1">최대 5MB까지 입력 가능합니다.</p>
            </div>
            
            <div class="flex justify-end gap-2 mt-6">
                <a href="{{ url_for('routes.index') }}" class="py-2 px-4 rounded-lg bg-gray-300 hover:bg-gray-400 transition-colors">취소</a>
                <button type="submit" class="py-2 px-4 rounded-lg bg-blue-500 hover:bg-blue-600 transition-colors text-white">저장</button>
            </div>
        </form>
        
        <div id="error-message" class="mt-4 text-red-500 font-semibold hidden"></div>
    </div>
</div>

<script>
$(document).ready(function() {
    $('#text-form').on('submit', function(e) {
        e.preventDefault();
        
        const contents = $('#contents').val();
        const errorMessageDiv = $('#error-message');
        
        errorMessageDiv.addClass('hidden').text('');

        if (contents.trim() === '') {
            errorMessageDiv.removeClass('hidden').text('내용을 입력해주세요.');
            return;
        }

        // 텍스트 크기 검사 (5MB 제한)
        const sizeInBytes = new Blob([contents]).size;
        const maxSizeBytes = 5 * 1024 * 1024;
        if (sizeInBytes > maxSizeBytes) {
            errorMessageDiv.removeClass('hidden').text('내용이 5MB를 초과했습니다.');
            return;
        }

        $.ajax({
            url: "{{ url_for('routes.create_text_api') }}",
            type: 'POST',
            contentType: 'application/json',
            data: JSON.stringify({ contents: contents }),
            success: function(response) {
                // 성공 시 목록 페이지로 이동
                window.location.href = "{{ url_for('routes.index') }}";
            },
            error: function(xhr) {
                const response = JSON.parse(xhr.responseText);
                errorMessageDiv.removeClass('hidden').text(response.error);
            }
        });
    });
});
</script>
{% endblock %}